var sfDataIntell=sfDataIntell||{};!function(a){a.Client=function(b){if(b=b||{},!b.apiKey)throw new Error("You must provide the ApiKey for the Data Center.");if(!b.source)throw new Error("You must provide the source name of the client.");this.isLocalStorageSupported=this.isLocalStorageSupported();var c=b.subjectCookieName||"sf-data-intell-subject",d=this.readCookie(c);if((null===d||""===d)&&(d=this.generateSubjectKey(),this.setCookie(c,d,365),window.detect)){var e=this.getParseUserAgent(),f=this.getBrowserLanguage();this.subjectMetadataClient=new a.SubjectMetadataClient(d,this.isLocalStorageSupported);var g=[{K:"browser-name",V:e.browser.family},{K:"browser-ver",V:e.browser.version},{K:"browser-lang",V:f},{K:"device-name",V:e.device.family},{K:"device-type",V:e.device.type}];null!==e.device.manufacturer&&""!==e.device.manufacturer&&g.push({K:"device-manuf",V:e.device.manufacturer}),this.subjectMetadataClient.writeSubjectMetadata(g)}this.apiKey=b.apiKey,this.source=b.source,this.apiServerUrl=b.apiServerUrl||"https://api.dec.sitefinity.com",this.sentenceClient=new a.SentenceClient(d,this.isLocalStorageSupported),this.subjectMetadataClient=new a.SubjectMetadataClient(d,this.isLocalStorageSupported),b.instrument&&(this.instrumenter=new a.HtmlInstrumenter(this.sentenceClient),this.instrumenter.startTracking()),b.trackPageVisits&&(this.pageVisitsTracker=new a.PageVisitsTracker(this.sentenceClient,b.trackPageVisits.predicate,b.trackPageVisits.obj,b.trackPageVisits.objMetadata),this.pageVisitsTracker.startTracking()),b.trackUtmParameters&&(this.utmParametersTracker=new a.UtmParametersTracker(this.sentenceClient,b.trackUtmParameters.predicate,b.trackUtmParameters.obj,b.trackUtmParameters.objMetadata,b.trackUtmParameters.subMetadata),this.utmParametersTracker.startTracking()),b.trackReferrer&&(this.referrerTracker=new a.ReferrerTracker(this.sentenceClient,b.trackReferrer.predicate,b.trackReferrer.obj,b.trackReferrer.objMetadata),this.referrerTracker.startTracking());var h=this;setInterval(function(){h.flushData(h)},5e3)},a.Client.prototype={generateSubjectKey:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})},setCookie:function(a,b,c){var d=new Date;d.setTime(d.getTime()+24*c*60*60*1e3);var e="expires="+d.toGMTString();document.cookie=a+"="+b+";path=/; "+e},readCookie:function(a){for(var b=a+"=",c=window.document.cookie.split(";"),d=0;d<c.length;d++){var e=c[d].trim();if(0===e.indexOf(b))return e.substring(b.length,e.length)}return null},flushData:function(a){var b,c;a.isLocalStorageSupported?(localStorage.sentences&&(b=JSON.parse(localStorage.sentences),a.flushSentences(a,b),localStorage.sentences=""),localStorage.subjectMetadata&&(c=JSON.parse(localStorage.subjectMetadata),a.flushSubjectMetadata(a,c),localStorage.subjectMetadata="")):(window.tempStorage.sentences&&(b=JSON.parse(window.tempStorage.sentences),a.flushSentences(a,b),window.tempStorage.sentences=""),window.tempStorage.subjectMetadata&&(c=JSON.parse(window.tempStorage.subjectMetadata),a.flushSubjectMetadata(a,c),window.tempStorage.subjectMetadata=""))},flushSentences:function(a,b){1==b.length&&(b=b[0]),$.ajax({url:a.apiServerUrl+"/collect/v1/data-centers/"+a.apiKey+"/sentences/datasource/"+a.source,type:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify(b)})},flushSubjectMetadata:function(a,b){1==b.length&&(b=b[0]),$.ajax({url:a.apiServerUrl+"/collect/v1/data-centers/"+a.apiKey+"/metadata/subjects/datasource/"+a.source,type:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify(b)})},getParseUserAgent:function(){var a=detect.parse(navigator.userAgent);return a},getBrowserLanguage:function(){var a=navigator.language||navigator.userLanguage;return a},isLocalStorageSupported:function(){var a="test";try{return localStorage.setItem(a,"1"),localStorage.removeItem(a),!0}catch(b){return window.tempStorage={},!1}}}}(sfDataIntell);var sfDataIntell=sfDataIntell||{};!function(a){a.decisionTreeClient={}}(sfDataIntell);var sfDataIntell=sfDataIntell||{};!function(a){a.HtmlInstrumenter=function(a){this.sentenceClient=a},a.HtmlInstrumenter.prototype={startTracking:function(){var a=this;$("[sfdi-trigger]").each(function(){var b=$(this),c=b.attr("sfdi-trigger"),d=b.attr("sfdi-predicate"),e=b.attr("sfdi-object"),f=b.attr("sfdi-obj-metadata"),g=b.attr("sfdi-sub-metadata");f=a.buildMetadataArray(f),g=a.buildMetadataArray(g),b.on(c,function(){a.sentenceClient.writeSentence({predicate:d,object:e,objectMetadata:f,subjectMetadata:g})})})},buildMetadataArray:function(a){return a?a=JSON.parse(a.replace(new RegExp("\\\\","gm"),"").replace(new RegExp("'","gm"),'"')):null}}}(sfDataIntell);var sfDataIntell=sfDataIntell||{};!function(a){a.SentenceClient=function(a,b){this.subjectKey=a,this.isLocalStorageSupported=b},a.SentenceClient.prototype={writeSentence:function(a){if(!a)throw new Error('You must provide "sentence" argument when writing a sentence.');if(!a.predicate)throw new Error('You must provide "sentence.predicate" argument when writing a sentence.');if(!a.object)throw new Error('You must provide "sentence.object" argument when writing a sentence.');var b;b=this.isLocalStorageSupported?localStorage.sentences?JSON.parse(localStorage.sentences):[]:window.tempStorage.sentences?JSON.parse(window.tempStorage.sentences):[],b.push({S:this.subjectKey,P:a.predicate,O:a.object,SM:a.subjectMetadata,OM:a.objectMetadata}),this.isLocalStorageSupported?localStorage.sentences=JSON.stringify(b):window.tempStorage.sentences=JSON.stringify(b)}}}(sfDataIntell);var sfDataIntell=sfDataIntell||{};!function(a){a.subjectMappingClient={}}(sfDataIntell);var sfDataIntell=sfDataIntell||{};!function(a){a.PageVisitsTracker=function(a,b,c,d){this.sentenceClient=a,this.predicate=b||"Visit",this.obj=c||location.href,this.objMetadata=d||[{K:"PageTitle",V:document.title}]},a.PageVisitsTracker.prototype={startTracking:function(){var a=this;$(document).ready(function(){a.sentenceClient.writeSentence({predicate:a.predicate,object:a.obj,objectMetadata:a.objMetadata})})}}}(sfDataIntell);var sfDataIntell=sfDataIntell||{};!function(a){a.SubjectMetadataClient=function(a,b){this.subjectKey=a,this.isLocalStorageSupported=b},a.SubjectMetadataClient.prototype={writeSubjectMetadata:function(a){if(!a)throw new Error('You must provide "metadata" argument when writing subject metadata.');var b;b=this.isLocalStorageSupported?localStorage.subjectMetadata?JSON.parse(localStorage.subjectMetadata):[]:window.tempStorage.subjectMetadata?JSON.parse(window.tempStorage.subjectMetadata):[],b.push({S:this.subjectKey,M:a}),this.isLocalStorageSupported?localStorage.subjectMetadata=JSON.stringify(b):window.tempStorage.subjectMetadata=JSON.stringify(b)}}}(sfDataIntell);var sfDataIntell=sfDataIntell||{};!function(a){a.UtmParametersTracker=function(a,b,c,d,e){this.sentenceClient=a,this.predicate=b||"Participate in campaign",this.obj=c||location.search,this.objMetadata=d,this.subMetadata=e},a.UtmParametersTracker.prototype={startTracking:function(){var a=this;$(document).ready(function(){a.handleUtmParamsTracking.call(a)})},handleUtmParamsTracking:function(){var a=this.buildUtmParamsObject(this.obj);null!==a&&this.sentenceClient.writeSentence({predicate:this.predicate,object:a,objectMetadata:this.objMetadata,subjectMetadata:this.subMetadata})},buildUtmParamsObject:function(a){if(a.indexOf("utm_source")>-1||a.indexOf("utm_medium")>-1||a.indexOf("utm_term")>-1||a.indexOf("utm_content")>-1||a.indexOf("utm_campaign")>-1){var b=a.slice(1).split("&"),c=b.filter(function(a){return a.indexOf("utm_source")>-1||a.indexOf("utm_medium")>-1||a.indexOf("utm_term")>-1||a.indexOf("utm_content")>-1||a.indexOf("utm_campaign")>-1}),d="?"+c.join("&");return d}return null}}}(sfDataIntell);var sfDataIntell=sfDataIntell||{};!function(a){a.ReferrerTracker=function(a,b,c,d){this.sentenceClient=a,this.predicate=b||"Come from site",this.obj=c||document.referrer,this.objMetadata=d},a.ReferrerTracker.prototype={startTracking:function(){var a=this;$(document).ready(function(){a.handleTracking.call(a,location.hostname)})},handleTracking:function(a){this.obj&&this.parseURL(this.obj).hostname!==a&&this.sentenceClient.writeSentence({predicate:this.predicate,object:this.obj,objMetadata:this.objMetadata})},parseURL:function(a){var b=document.createElement("a");return b.href=a,{source:a,hostname:b.hostname}}}}(sfDataIntell);